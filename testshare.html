<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Test Share</title>
</head>
<body>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script src="js/jquery.min.js"></script>
<script>

var signature = localStorage.signature ? localStorage.signature : '';
var accessToken = localStorage.accessToken ? localStorage.accessToken : '';




if(accessToken!=''){
  var timestamp = Date.parse(new Date()); 
  var nonceStr = Math.round() + '';
  //获取accessToken
  $.ajax({
    type: "GET",
    url:'https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wxd31771b7d224b883&secret=60fd9ce92eb04c67514d9a971484e2d1',
    cache: false,
    async: false,
    dataType:'json',
    success: function(data){
      //缓存accessToken
      localStorage.accessToken = data.access_token;
      accessToken = data.access_token;
    }
  });
}

if(signature!="" && accessToken!=""){
  $.ajax({
    type: "GET",
    url:'https://api.weixin.qq.com/cgi-bin/ticket/getticket?access_token='+ accessToken +'&type=jsapi',
    cache: false,
    async: false,
    dataType:'json',
    success: function(data){
      console.log(data);
      if(data.errmsg=='ok'){
        localStorage.signature = data.ticket;
        signature = data.ticket;
      }
    }
  });  
}






wx.config({
  debug: true, // 开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
  appId: 'wxd31771b7d224b883', // 必填，公众号的唯一标识
  timestamp: timestamp, // 必填，生成签名的时间戳
  nonceStr: nonceStr, // 必填，生成签名的随机串
  signature: signature,// 必填，签名，见附录1
  jsApiList: [onMenuShareTimeline] // 必填，需要使用的JS接口列表，所有JS接口列表见附录2
});


wx.onMenuShareTimeline({

    title: '我就是独立自强的Max!美！快来测测你是哪款白富美～', 
    
    link: 'http://download.ichuanyi.com/bfm/', 
    
    imgUrl: 'http://download.ichuanyi.com/bfm/images/share-test.jpg', 
    
    success: function () { 
      alert('用户确认分享');
    },
    
    cancel: function () { 
      alert('用户取消分享');
    }
});

</script>
</body>
</html>